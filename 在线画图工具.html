<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <style>
    body {
      text-align: center;
    }

    canvas {
      border: 1px solid #000;
    }

    .controls {
      float: left;
      height: 100px;
      border: 1px solid #000;
    }
  </style>
</head>

<body>
  <div class="controls">
    <input type="color" class="col_inp">
    <select class="lineWidth_sel">
      <option value="1">1px</option>
      <option value="5">5px</option>
      <option value="10">10px</option>
      <option value="15">15px</option>
    </select>
    <button class="line">线条</button>
    <button class="rect">矩形</button>
    <button class="clearCa">橡皮擦</button>
    <button class="resetCas">重置画布</button>
  </div>
  <canvas width="600" height="600"></canvas>
  <script>
    var cas = document.querySelector("canvas");
    var col_inp = document.querySelector(".col_inp");
    var lineWidth_sel = document.querySelector(".lineWidth_sel");
    var line = document.querySelector(".line");
    var rect = document.querySelector(".rect");
    var clearCa = document.querySelector(".clearCa");
    var resetCas = document.querySelector(".resetCas");
    var ctx = cas.getContext("2d");

    // 全局配置对象
    var CasAttr = {
      lineWidth: 1,
      color: "#000",
      // 默认 画线条
      lineWhat: "line",
      // 鼠标按下的点
      startPoint: {
        x: 0,
        y: 0
      }
    };

    // 开关
    var isDraw = false;

    // 鼠标按下
    cas.addEventListener("mousedown", function (e) {
      isDraw = true;

      ctx.beginPath();
      // 设置线条
      ctx.lineWidth = CasAttr.lineWidth;
      ctx.strokeStyle = CasAttr.color;

      // 记录坐标
      CasAttr.startPoint.x = e.offsetX;
      CasAttr.startPoint.y = e.offsetY;
    })

    cas.addEventListener("mousemove", function (e) {
      if (!isDraw) {
        return;
      }
      var endX = e.offsetX;
      var endY = e.offsetY;
      // 画线条
      if (CasAttr.lineWhat == "line") {
        ctx.lineTo(endX, endY);
        ctx.stroke();
      }
      // 擦除
      else if (CasAttr.lineWhat == "clearCa") {
        ctx.clearRect(endX, endY, 20, 20);
      }
    })

    cas.addEventListener("mouseup", function (e) {
      isDraw = false;
      if (CasAttr.lineWhat == "rect") {
        var endX = e.offsetX;
        var endY = e.offsetY;
        var w = endX - CasAttr.startPoint.x;
        var h = endY - CasAttr.startPoint.y;
        ctx.strokeRect(CasAttr.startPoint.x, CasAttr.startPoint.y, w, h);
      }
    })


    // 选取颜色
    col_inp.onchange = function () {
      CasAttr.color = this.value;
    }

    // 选取线条的宽度
    lineWidth_sel.onchange = function () {
      CasAttr.lineWidth = this.value;
    }

    // 点击画线条按钮
    line.addEventListener("click", function () {
      CasAttr.lineWhat = "line";
    })
    // 点击画矩形按钮
    rect.addEventListener("click", function () {
      CasAttr.lineWhat = "rect";
    })

    // 点击橡皮擦
    clearCa.addEventListener("click", function () {
      CasAttr.lineWhat = "clearCa";
    })

    // 重置
    resetCas.addEventListener("click", function () {
      ctx.clearRect(0, 0, cas.width, cas.height);
    })
  </script>
</body>

</html>